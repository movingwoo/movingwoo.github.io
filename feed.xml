<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ko-KR"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://movingwoo.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://movingwoo.com/" rel="alternate" type="text/html" hreflang="ko-KR" /><updated>2025-09-15T08:52:45+00:00</updated><id>https://movingwoo.com/feed.xml</id><title type="html">뭐라도 하겠지</title><subtitle>개발, C++, JAVA, Python, Shortcut, 백준</subtitle><entry><title type="html">도메인 네임서버 변경</title><link href="https://movingwoo.com/server/2025/09/15/Migrating-Domain.html" rel="alternate" type="text/html" title="도메인 네임서버 변경" /><published>2025-09-15T08:00:00+00:00</published><updated>2025-09-15T08:00:00+00:00</updated><id>https://movingwoo.com/server/2025/09/15/Migrating%20Domain</id><content type="html" xml:base="https://movingwoo.com/server/2025/09/15/Migrating-Domain.html"><![CDATA[<blockquote>
  <h4 id="머리말">머리말</h4>
  <hr />
</blockquote>

<p>Cloudflare Tunnel 을 사용하기 위한 사전 작업이 있다.<br />
<span style="color: orange;"><strong>도메인 네임서버를 Cloudflare로 변경</strong></span>해야한다.</p>

<p>정말 귀찮기 그지없는 작업이지만 일단 해보자.</p>

<p>현재 글을 올리는 movingwoo.com 도메인은 porkbun 에서 구입하여 이용 중이다.<br />
이 도메인의 네임서버를 cloudflare 로 이전한다.</p>

<blockquote>
  <h4 id="cloudflare란">Cloudflare란?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img01.webp" alt="img01" /></p>

<p>사실 인터넷 좀 해봤으면 cloudflare에 대해 한 번 쯤은 봤을 확률이 높다.<br />
대충 서버 터졌을때 클라우드플레어 어쩌고 저쩌고 뜬다.</p>

<p>그만큼 많이들 사용하는 인프라 서비스 회사인데, 2010년 설립되었다고 한다.<br />
생각보다 후발주자이다.<br />
그래도 무료 플랜 접근성이 좋고 간편하여 빠르게 성장하여 지금의 cloudflare가 되었다고 한다.</p>

<p>무료 플랜이 강력하긴 한데 회사가 커지면서 일부 보안 기능들이 유료화되어가는 추세라는데…<br />
일단 터널은 무료로 제공해주니 써보자.<br />
즐길 수 있을때 즐겨야지</p>

<blockquote>
  <h4 id="네임서버-변경-작업">네임서버 변경 작업</h4>
  <hr />
</blockquote>

<p><a href="https://dash.cloudflare.com/">Cloudflare Dashboard</a></p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img02.webp" alt="img02" /></p>

<p>가입하면 도메인을 등록하라고 뜬다.<br />
순서대로 하라는대로 진행하면 된다.</p>

<p>한국어 지원 해주는게 마음에 든다.<br />
품질도 정말 나쁘지 않다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img03.webp" alt="img03" /></p>

<p>DNS 레코드 추가는 <span style="color: orange;"><strong>빠른 스캔</strong></span>으로 진행한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img04.webp" alt="img04" /></p>

<p>플랜 선택 화면.<br />
당연히 <span style="color: orange;"><strong>무료 플랜</strong></span>을 선택하겠지만, 프로 플랜부터 기능이 매력적이긴하다.</p>

<p>사실 1개월 20딸라면 요즘 AI 구독과 비슷한 가격이다.<br />
막 접근성이 없진 않은 가격이다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img05.webp" alt="img05" /></p>

<p>빠른 스캔으로 가져온 DNS 레코드 리스트가 뜬다.</p>

<p>포크번에서 자동으로 긁어온 리스트인데<br />
기존 등록되어있는 A 레코드와 TXT 레코드 외에 NS 레코드가 보인다.<br />
포크번 네임서버 리스트인데 우선은 그대로 가져간다.</p>

<p>NS 레코드는 네임서버 이전이 완료되면 안전하게 삭제하도록 한다.<br />
사실 잘 모르면 손대지 않고 냅두는게 최고다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img06.webp" alt="img06" /></p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img07.webp" alt="img07" /></p>

<p>마지막 단계를 위해 기존 도메인 등록기관, 내 경우 포크번에 로그인이 필요하다.<br />
<span style="color: orange;"><strong>DNSSEC 기능을 종료</strong></span> 후, <span style="color: orange;"><strong>네임 서버를 cloudflare에서 제공해주는 값으로 교체</strong></span>한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img08.webp" alt="img08" /></p>

<p>이 부분은 시간이 상당 소요될 수 있는데<br />
나는 트래픽 쥐꼬리만큼도 없는 싸구려 도메인이라 바로 처리됨…</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img09.webp" alt="img09" /></p>

<p>대시보드에서 상태가 <span style="color: orange;"><strong>활성</strong></span>으로 나오면 끝이다.</p>

<blockquote>
  <h4 id="추가-보안-작업">추가 보안 작업</h4>
  <hr />
</blockquote>

<p>아까 DDNSEC을 종료했으므로 DDNSEC을 활성화 시켜야하고<br />
TLS와 같은 기초적인 설정도 마저 진행한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img10.webp" alt="img10" /></p>

<p>딸깍으로 SSL/TLS 자동 적용.<br />
원래 이부분은 포크번도 딸깍으로 했던 것 같다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img11.webp" alt="img11" /></p>

<p>DNSSEC 활성화를 하려면 <span style="color: orange;"><strong>DS 레코드를 등록기관에 추가</strong></span>해야한다.</p>

<p>만약 내가 도메인 자체를 클라우드플레어로 이전했다면 이부분은 간단하게 끝났겠지만<br />
네임서버만 변경한거라 이 작업은 포크번에 직접 해줘야한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img12.webp" alt="img12" /></p>

<p>제공해주는 값들을 그대로 입력해주기만 하면 된다.</p>

<p>이것은 간단한 레고조립과 같다.<br />
아기들 모양 맞춰서 블럭 넣는 장난감과 다름 없다.<br />
맞는 칸에 넣고 없는 칸은 비우고 등록한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img13.webp" alt="img13" /></p>

<p><span style="color: red;"><strong>잉?</strong></span></p>

<p>시간이 지나도 등록이 안되어 문의 결과, keyData 쪽 입력 때문에 검증 실패로 오류가 나는 것이라 한다.<br />
keyData 제외하고 <span style="color: orange;"><strong>dsData 쪽만 입력</strong></span>해주면 성공적으로 등록된다…</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img14.webp" alt="img14" /></p>

<p>클라우드플레어 대시보드에서도 DNSSEC 적용을 확인할 수 있다.</p>

<blockquote>
  <h4 id="꼬리말">꼬리말</h4>
  <hr />
</blockquote>

<p>이 외 보안 관련 다양한 메뉴들이 있는데 대부분 프로 플랜 이상을 권유하고 있어서 쓰기 힘들다.<br />
봇 막는 기능 등은 무료인데 굳이 막아야하나 싶기도 하고…</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img15.webp" alt="img15" /></p>

<p>제일 안타까운건 이 최대 업로드 크기 부분인데<br />
100mb 제한이 있고 비즈니스 플랜부터 늘릴 수 있다.</p>

<p><img src="/assets/images/posts/Server/2025-09-16-Migrating Domain/img16.webp" alt="img16" /></p>

<p>이렇게 <span style="color: orange;"><strong>오렌지색 구름 모양</strong></span>으로 클라우드플레어 프록시를 거치는 경우 저 제한이 적용된다.<br />
개인 서버라 큰 이슈는 없을 것 같은데 일단 사용해봐야 알 것 같다.<br />
가늠이 잘 안가는데, 제한 때문에 문제생기면 프록시 풀거나 하면 되겠지.</p>]]></content><author><name>movingwoo</name></author><category term="Server/" /><category term="SERVER" /><category term="도메인" /><category term="네임서버" /><category term="CLOUDFLARE" /><summary type="html"><![CDATA[Cloudflare로 도메인 네임서버 변경]]></summary></entry><entry><title type="html">Traefik 구축, 설정</title><link href="https://movingwoo.com/server/web/2025/09/15/Setting-Traefik.html" rel="alternate" type="text/html" title="Traefik 구축, 설정" /><published>2025-09-15T06:00:00+00:00</published><updated>2025-09-15T06:00:00+00:00</updated><id>https://movingwoo.com/server/web/2025/09/15/Setting%20Traefik</id><content type="html" xml:base="https://movingwoo.com/server/web/2025/09/15/Setting-Traefik.html"><![CDATA[<blockquote>
  <h4 id="머리말">머리말</h4>
  <hr />
</blockquote>

<p>원래 이번 3호기 구축하며 cloudflare tunnel을 사용해볼 생각이었다.<br />
포트를 열지 않고 보안을 cloudflare에 맡겨버리는게 상당히 매력적인 선택지다.</p>

<p>보안 설정을 직접 해야한다면 상당히 피곤하지만 재미는 있다.<br />
만약 cloudflare tunnel을 쓰지 않고 직접 포트 열고 웹서버를 구축해서 사용한다면?</p>

<p>nginx 정도는 여러 번 사용해봤고, SSL 인증서 자동 갱신을 위해 acme-companion까지 사용해본 적 있다.<br />
한 번 설정하면 다시는 손대기 싫은게 단점이었는데<br />
<span style="color: orange;"><strong>traefik</strong></span>을 사용하면 더 적은 설정으로 HTTPS, 라우팅, 보안 미들웨어까지 해결해준다고 한다.</p>

<p>경험삼아 traefik을 한 번 설정해보자.</p>

<blockquote>
  <h4 id="traefik이란">Traefik이란?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/Server/WEB/2025-09-15-Setting Traefik/img01.webp" alt="img01" /></p>

<p>요 캐릭터는 많이 봤다.</p>

<p>traefik은 <span style="color: orange;"><strong>레이블 기반 선언형 라우팅</strong></span>을 사용해서<br />
각 서비스 컨테이너에 레이블만 달아주면 알아서 도메인 매핑, 경로 라우팅을 해준다.<br />
traefik <span style="color: orange;"><strong>자체적으로 인증서 발급, 갱신</strong></span>을 해주기도 한다.<br />
보안 미들웨어도 내장하고 있고, 로그 경로를 호스트에 마운트해서 fail2ban과 연계할 수도 있다.</p>

<p>레이블만 대충 바꿔주면 된다는 점이 매력포인트다.<br />
관리포인트는 적어질수록 좋다.</p>

<p>대시보드도 제공하는데 별로 필요없어 보여서 대시보드는 제외하고 설정한다.<br />
괜히 쓸데없는 노출이 늘어나는 것이기도 하다.<br />
그냥 로그 보면 다 나오는데 뭔 대시보드야</p>

<blockquote>
  <h4 id="설정-및-기동">설정 및 기동</h4>
  <hr />
</blockquote>

<h5 id="1-docker-composeyml">1. docker-compose.yml</h5>

<p>도커로 올린다.<br />
레이블 설정까지 정상적으로 먹히는지 확인하기 위해 빈 서비스로 tomcat 깡통을 하나 같이 올린다.</p>

<p>fail2ban 적용을 위한 로그와 공통 설정파일을 밖으로 빼고<br />
tomcat 에는 label만 잘 맞춰준다.</p>

<p>ratelimit은 앞으로의 사용을 고려해 조절해야하는데<br />
우선 테스트를 위해 일반적인 웹 요청에 적당한 값으로 세팅했다.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">networks</span><span class="pi">:</span>
  <span class="na">proxy</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">traefik:3.5.2</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">proxy</span><span class="pi">]</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">--entrypoints.web.address=:80</span>
      <span class="pi">-</span> <span class="s">--entrypoints.websecure.address=:443</span>
      <span class="pi">-</span> <span class="s">--entrypoints.web.http.redirections.entryPoint.to=websecure</span>
      <span class="pi">-</span> <span class="s">--entrypoints.web.http.redirections.entryPoint.scheme=https</span>
      <span class="pi">-</span> <span class="s">--providers.docker=true</span>                    <span class="c1"># 도커 레이블로 라우팅/미들웨어 정의</span>
      <span class="pi">-</span> <span class="s">--providers.docker.exposedbydefault=false</span>  <span class="c1"># 레이블에 enable=true 있는 컨테이너만 공개</span>
      <span class="pi">-</span> <span class="s">--providers.file.directory=/dynamic</span>
      <span class="pi">-</span> <span class="s">--certificatesresolvers.le.acme.tlschallenge=true</span>
      <span class="pi">-</span> <span class="s">--certificatesresolvers.le.acme.email=id@mail.com</span>
      <span class="pi">-</span> <span class="s">--certificatesresolvers.le.acme.storage=/letsencrypt/acme.json</span>
      <span class="pi">-</span> <span class="s">--accesslog=true</span>
      <span class="pi">-</span> <span class="s">--accesslog.filepath=/var/log/traefik/access.log</span>
      <span class="pi">-</span> <span class="s">--log.level=INFO</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      <span class="pi">-</span> <span class="s">./letsencrypt:/letsencrypt</span>
      <span class="pi">-</span> <span class="s">./logs/traefik:/var/log/traefik</span>  <span class="c1"># fail2ban 위한 로그</span>
      <span class="pi">-</span> <span class="s">./dynamic:/dynamic:ro</span> 
    <span class="na">security_opt</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">no-new-privileges:true</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik.enable=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.sec-headers.headers.stsSeconds=300</span>               <span class="c1"># HSTS 테스트용 5분</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.sec-headers.headers.stsIncludeSubdomains=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.sec-headers.headers.stsPreload=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.sec-headers.headers.contentTypeNosniff=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.sec-headers.headers.frameDeny=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.ratelimit.ratelimit.average=20</span>  <span class="c1"># 초당 평균 허용 요청수</span>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.ratelimit.ratelimit.burst=40</span>    <span class="c1"># 버스트</span>

  <span class="na">tomcat</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">tomcat:10-jdk17-corretto</span>   <span class="c1"># 테스트용 Tomcat 10</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">proxy</span><span class="pi">]</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik.enable=true</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.tomcat.rule=Host(`test.domain.io`)</span>       <span class="c1"># 도메인</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.tomcat.entrypoints=websecure</span>             <span class="c1"># HTTPS에서만 서비스</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.tomcat.tls.certresolver=le</span>               <span class="c1"># 위에서 정의한 ACME resolver</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.tomcat.tls.options=strict-tls@file</span>       <span class="c1"># 파일 프로바이더의 TLS 정책</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.tomcat.middlewares=sec-headers,ratelimit</span> <span class="c1"># 공통 미들웨어</span>
      <span class="pi">-</span> <span class="s">traefik.http.services.tomcat.loadbalancer.server.port=8080</span>    <span class="c1"># 컨테이너 내부 포트</span>
</code></pre></div></div>

<p>추후 서브 도메인만 변경해 다른 앱을 올릴 경우<br />
서비스 레이블에 다른 도메인을 세팅해주면 해당 도메인으로 인증서를 발급받아준다.</p>

<h5 id="2-기동">2. 기동</h5>

<p><img src="/assets/images/posts/Server/WEB/2025-09-15-Setting Traefik/img02.webp" alt="img02" /></p>

<p><img src="/assets/images/posts/Server/WEB/2025-09-15-Setting Traefik/img03.webp" alt="img03" /></p>

<p><span style="color: orange;"><strong>docker compose up -d</strong></span> 명령어로 기동한다.<br />
정상적으로 컨테이너가 올라간 것을 보고 docker logs 명령어로 오류가 없는지 확인한다.<br />
로그가 전부 INFO 레벨인걸 보니 이상이 없어보인다.</p>

<p>브라우저로 접근해보자.</p>

<p><img src="/assets/images/posts/Server/WEB/2025-09-15-Setting Traefik/img04.webp" alt="img04" /></p>

<p>TLS 인증서가 적용되어있고, 404 페이지가 뜬다.<br />
깡통 톰캣 컨테이너에 아무것도 들어있지 않아 404가 뜨는거라 정상적인 접근이다.</p>

<h5 id="3-fail2ban-연동">3. fail2ban 연동</h5>

<p>필터를 새롭게 설정하여 fail2ban 연동을 진행한다.<br />
이 부분 또한 실제 사용에 따라 세부 설정이 필요한데<br />
우선은 테스트로 적당히 값 집어넣어서 설정한다.</p>

<p><span style="color: orange;"><strong>429, 404, 시그니처 스캔 필터</strong></span> 3가지를 만든다.<br />
429는 traefik이 429 Too Many Requests로 거른 요청들을 차단하고<br />
시그니처 스캔 필터는 /.git /wp-login.php 등 잘 알려진 취약점이나 관리 페이지 경로를 차단한다.</p>

<p>추후 모든 요청(성공 포함)이나 봇 요청에 대한 필터를 추가할 수 있겠다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/fail2ban/jail.d/traefik-access.conf</span>
  
<span class="o">[</span>DEFAULT]
action <span class="o">=</span> ufw
logpath <span class="o">=</span> /app/logs/traefik/access.log
backend <span class="o">=</span> auto

<span class="o">[</span>traefik-rate-429]
enabled  <span class="o">=</span> <span class="nb">true
</span>filter   <span class="o">=</span> traefik-rate-429
maxretry <span class="o">=</span> 5
findtime <span class="o">=</span> 60
bantime  <span class="o">=</span> 3600

<span class="o">[</span>traefik-rate-404]
enabled  <span class="o">=</span> <span class="nb">true
</span>filter   <span class="o">=</span> traefik-rate-404
maxretry <span class="o">=</span> 10
findtime <span class="o">=</span> 600
bantime  <span class="o">=</span> 3600

<span class="o">[</span>traefik-scan]
enabled  <span class="o">=</span> <span class="nb">true
</span>filter   <span class="o">=</span> traefik-scan
findtime <span class="o">=</span> 600
maxretry <span class="o">=</span> 3
bantime  <span class="o">=</span> <span class="nt">-1</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/fail2ban/filter.d/traefik-rate-429.conf</span>
<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">".*"</span> 429 .<span class="k">*</span>
ignoreregex <span class="o">=</span>

<span class="c"># /etc/fail2ban/filter.d/traefik-rate-404.conf</span>
<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">".*"</span> 404 .<span class="k">*</span>
ignoreregex <span class="o">=</span>

<span class="c"># /etc/fail2ban/filter.d/traefik-scan.conf</span>
<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"(GET|POST|HEAD) .*(/wp-login</span><span class="se">\.</span><span class="s2">php|/wp-admin|/xmlrpc</span><span class="se">\.</span><span class="s2">php|/phpmyadmin|/pma/|/vendor/phpunit|/</span><span class="se">\.</span><span class="s2">env|/</span><span class="se">\.</span><span class="s2">git/|/server-status|/actuator|/manager/html|/jmx-console|/HNAP1|/boaform|/config</span><span class="se">\.</span><span class="s2">json|/id_rsa|/adminer</span><span class="se">\.</span><span class="s2">php|/shell</span><span class="se">\.</span><span class="s2">php)"</span> .<span class="k">*</span>
ignoreregex <span class="o">=</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/Server/WEB/2025-09-15-Setting Traefik/img05.webp" alt="img05" /></p>

<p>fail2ban을 재기동하여 필터를 확인한다.<br />
현재는 tomcat 깡통이 전부 404 Not Found로 빠지기 때문에 404 필터에 실패 요청이 쌓여있다.</p>

<h5 id="4-로그-분리">4. 로그 분리</h5>

<p>access.log는 한 파일에 계속해서 쌓이기 때문에 분리할 필요가 있다.<br />
fail2ban이 놓치지 않게 copytruncate 방식으로 logrotate 규칙을 설정한다.</p>

<p>오래된 RHEL 계열 서버에서는 따로 crontab 등록했던 거 같은데…<br />
요즘엔 알아서 돌려주나보다.<br />
편하다 편해.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/logrotate.d/traefik</span>

/app/logs/traefik/access.log <span class="o">{</span>
  daily
  rotate 30
  compress
  delaycompress
  missingok
  copytruncate
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <h4 id="꼬리말">꼬리말</h4>
  <hr />
</blockquote>

<p>traefik 설정이 굉장히 쉽고 간편해서 빠르게 끝났다.<br />
nginx 쓸때는 100% 에러 뿜뿜하고 트러블슈팅 들어가야할텐데 말이다.</p>

<p>언젠가 cloudflare 의존 없이 직접 제어해야할 상황이 온다면 본격적으로 traefik을 사용해볼 것 같다.<br />
첫 인상이 아주 좋다.</p>]]></content><author><name>movingwoo</name></author><category term="Server/WEB/" /><category term="SERVER" /><category term="WEB" /><category term="도커" /><category term="구축" /><category term="설정" /><category term="TRAEFIK" /><summary type="html"><![CDATA[Traefik 첫 구축, 설정]]></summary></entry><entry><title type="html">3호기 서버 설정</title><link href="https://movingwoo.com/server/2025/09/12/Server-MK3-Setting.html" rel="alternate" type="text/html" title="3호기 서버 설정" /><published>2025-09-12T02:00:00+00:00</published><updated>2025-09-15T04:00:00+00:00</updated><id>https://movingwoo.com/server/2025/09/12/Server%20MK3%20Setting</id><content type="html" xml:base="https://movingwoo.com/server/2025/09/12/Server-MK3-Setting.html"><![CDATA[<blockquote>
  <h4 id="이어서">이어서</h4>
  <hr />
</blockquote>

<p>생각해보니 램 얼만지 확인을 안해봤다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img01.webp" alt="img01" /></p>

<p>아니 무슨 40기가나 박혀있네?<br />
내 게임 PC가 32기가일텐데…</p>

<blockquote>
  <h4 id="설정할-내용">설정할 내용</h4>
  <hr />
</blockquote>

<p>계정을 여러개 쓰지 않을거라 돌이킬 수 없는 결과를 낳을 듯한 faillock은 제외하고 간단하게 4가지를 설정한다.</p>
<ul>
  <li><span style="color: orange;"><strong>root 로그인 비활성화</strong></span></li>
  <li><span style="color: orange;"><strong>ssh 포트 변경</strong></span></li>
  <li><span style="color: orange;"><strong>fail2ban</strong></span></li>
  <li><span style="color: orange;"><strong>세션 타임아웃</strong></span></li>
</ul>

<p>그 외 설정으로 bash 프롬프트 수정과 히스토리 최적화 등을 진행한다.</p>

<blockquote>
  <h4 id="설정">설정</h4>
  <hr />
</blockquote>

<h5 id="1-업그레이드">1. 업그레이드</h5>

<p>22.04로 설치했으니 24.04로 업그레이드를 우선 진행한다.<br />
이것저것 설치되어 있을수록 업그레이드가 부담되니까 깡통일때 해버리는게 낫다.</p>

<p><span style="color: orange;"><strong>sudo do-release-upgrade</strong></span><br />
명령어 입력 후 콘솔 안내에 따라 업그레이드를 진행한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img02.webp" alt="img02" /></p>

<p>업그레이드 중 언어셋이 en_US.UTF-8 인걸 확인했다.<br />
데스크탑 설치에는 한국어 설정이 있었는데 서버 설치에는 없어서 전체 영어로 진행되는 상황.<br />
ko_KR.UTF-8 로 바꿔줘야겠다.</p>

<p><span style="color: orange;"><strong>sudo apt install language-pack-ko</strong></span><br />
<span style="color: orange;"><strong>sudo update-locale LANG=ko_KR.UTF-8</strong></span></p>

<p>언어팩을 설치하고 locale을 바꿔준다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img03.webp" alt="img03" /></p>

<p>안내문이 한글로 뜨는 것을 볼 수 있다.</p>

<h5 id="2-sshd-설정">2. sshd 설정</h5>

<p><span style="color: orange;"><strong>/etc/ssh/sshd_config</strong></span> 파일을 수정하면<br />
ssh 포트 변경, root 로그인 차단을 처리할 수 있다.<br />
추가로 네트워크 응답이 없으면 끊기게 시간제한도 설정한다.</p>

<p>사실 포트 변경과 루트 차단은 굳이 설정할 필요가 없다.<br />
22번 포트는 앞단에서 포트 포워딩을 하기 때문에 직접 노출되지 않고<br />
우분투는 설치 시 생성하는 계정에 sudo 권한을 주고 root 계정을 바로 사용하지 않기 때문에 어차피 로그인이 안된다.<br />
그래도 기분 문제가 있으니 변경하기로 한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/ssh/sshd_config</span>

Port 12345                <span class="c"># 포트</span>
PermitRootLogin no        <span class="c"># 루트 로그인 비허용</span>
ClientAliveInterval 300   <span class="c"># 종료대기 시간(s)</span>
ClientAliveCountMax 0     <span class="c"># 실패 횟수</span>
</code></pre></div></div>

<p>아직 서버 접근할 고정적인 환경이 정해지지 않은 상태라 인증서 로그인 설정은 생략한다.</p>

<h5 id="3-fail2ban">3. fail2ban</h5>

<p>fail2ban은 로그 파일을 모니터링해서 이상 로그인 패턴을 찾아 차단하는 도구이다.<br />
<span style="color: orange;"><strong>sudo apt install fail2ban</strong></span> 명령어로 설치한다.</p>

<p><span style="color: orange;"><strong>/etc/fail2ban/jail.conf</strong></span> 파일이 설정파일인데<br />
개인 설정을 위해 복사해서 <span style="color: orange;"><strong>jail.local</strong></span> 파일을 만들고 sshd 블럭을 찾아 수정한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/fail2ban/jail.local</span>

<span class="o">[</span>sshd]
enabled   <span class="o">=</span> <span class="nb">true                          
</span>port      <span class="o">=</span> 12345             <span class="c"># ssh 포트</span>
filter    <span class="o">=</span> sshd
logpath   <span class="o">=</span> %<span class="o">(</span>sshd_log<span class="o">)</span>s
backend   <span class="o">=</span> %<span class="o">(</span>sshd_backend<span class="o">)</span>s
banaction <span class="o">=</span> ufw               <span class="c"># ufw 사용</span>
maxretry  <span class="o">=</span> 5                 <span class="c"># 시도 횟수</span>
bantime   <span class="o">=</span> <span class="nt">-1</span>                <span class="c"># 영구밴</span>
findtime  <span class="o">=</span> 600               <span class="c"># 지정한 시간 내 탐색</span>
ignoreip  <span class="o">=</span> 127.0.0.1/8       <span class="c"># 허용 IP</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img06.webp" alt="img06" /></p>

<p>설정 후 fail2ban 재시작하고 일부러 패스워드를 틀려본다.</p>

<p><span style="color: orange;"><strong>sudo fail2ban-client status sshd</strong></span><br />
명령어 입력 시 사진과 같이 잘못된 로그인을 탐지한 것을 볼 수 있다.</p>

<h5 id="4-bash-설정">4. bash 설정</h5>

<p><span style="color: orange;"><strong>.bashrc</strong></span> 파일을 수정해서 idle logout과 프롬프트, 히스토리를 수정한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># idle logout</span>
<span class="nb">export </span><span class="nv">TIMEOUT</span><span class="o">=</span>300

<span class="c"># prompt</span>
<span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'\w\$ '</span>

<span class="c"># edit history</span>
<span class="nb">export </span><span class="nv">HISTSIZE</span><span class="o">=</span>50000
<span class="nb">export </span><span class="nv">HISTFILESIZE</span><span class="o">=</span>100000
<span class="nb">export </span><span class="nv">HISTCONTROL</span><span class="o">=</span>ignoredups:erasedups:ignorespace
<span class="nb">export </span><span class="nv">HISTTIMEFORMAT</span><span class="o">=</span><span class="s1">'%F %T '</span>
<span class="nb">shopt</span> <span class="nt">-s</span> histappend
<span class="nv">PROMPT_COMMAND</span><span class="o">=</span><span class="s1">'history -a; history -n; '</span><span class="s2">"</span><span class="nv">$PROMPT_COMMAND</span><span class="s2">"</span>
</code></pre></div></div>

<p>프롬프트에는 계정과 호스트를 빼고 경로만 남긴다.<br />
히스토리를 정리하지 않으면 기본적으로</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img04.webp" alt="img04" /></p>

<p>이렇게 나오는데<br />
중복제거, 타임스탬프 추가 등 작업을 통해 아래와 같이 깔끔하게 정리할 수 있다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img05.webp" alt="img05" /></p>

<h5 id="5-도커-설치">5. 도커 설치</h5>

<p>아 도커는 필수 툴이지.<br />
작업 PC 환경은 로키 리눅스를 사용하는데 우분투는 또 설치방법이 조금 다르다.<br />
조금 더 길다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 필수 패키지 확인</span>
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> ca-certificates curl gnupg

<span class="c"># gpg 키 및 repo 등록</span>
<span class="nb">sudo install</span> <span class="nt">-m</span> 0755 <span class="nt">-d</span> /etc/apt/keyrings
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/keyrings/docker.gpg
<span class="nb">echo</span> <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null

<span class="c"># 설치</span>
<span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

<span class="c"># 실행, 권한부여</span>
<span class="nb">sudo </span>systemctl <span class="nb">enable</span> <span class="nt">--now</span> docker
<span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img07.webp" alt="img07" /></p>

<p>정상적으로 서비스 올라온 것을 확인하면 끝.</p>

<h5 id="6-공지-수정">6. 공지 수정</h5>

<p>서버 계정 로그인 시 공지가 뜬다.<br />
버전 정보나 간단한 안내문, 업데이트 관련 정보가 노출이 되는데 대부분 필요없다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img08.webp" alt="img08" /></p>

<p>현재 정보에서 시스템 정보, 업데이트 가능 여부, 마지막 로그인 3가지 정보만 남기고 다 지워보자.</p>

<p><span style="color: orange;"><strong>/etc/update-motd.d</strong></span> 경로로 들어가면 공지 관련 파일들이 있다.<br />
파일들은 숫자 순서로 실행된다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img09.webp" alt="img09" /></p>

<p>마지막 로그인은 PAM 에서 출력하니 상관없다.<br />
파일들을 확인해서 보여주지 않을 내용이 있는 파일에 대한 실행 권한을 제거한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img10.webp" alt="img10" /></p>

<p>이후 로그인 해보면 공지가 상당수 줄어든 것을 볼 수 있다.</p>

<p><img src="/assets/images/posts/Server/2025-09-12-Server MK3 Setting/img11.webp" alt="img11" /></p>

<p>ESM 메시지는 업데이트 메시지에 딸려오는거 같은데…<br />
수동 제거하거나 커스텀해야하는데 귀찮으니 당분간 냅두자.<br />
근데 뭐했다고 온도가 60도가 넘지?</p>

<blockquote>
  <h4 id="마무리">마무리</h4>
  <hr />
</blockquote>

<p>금방 설정하고 끝날 줄 알았는데 생각보다 이것도 해야지 저것도 해야지 하다보니 바빠졌다.</p>

<p>분명 또 빼먹은게 있을테니 쉬면서 생각나면 추가로 진행하고 서비스 올려봐야겠다.</p>]]></content><author><name>movingwoo</name></author><category term="Server/" /><category term="SERVER" /><category term="ubuntu" /><category term="구축" /><category term="설정" /><summary type="html"><![CDATA[3호기 개인 우분투 서버 설정]]></summary></entry><entry><title type="html">3호기 서버 구축</title><link href="https://movingwoo.com/server/2025/09/11/Build-Server-MK3.html" rel="alternate" type="text/html" title="3호기 서버 구축" /><published>2025-09-11T02:00:00+00:00</published><updated>2025-09-11T02:00:00+00:00</updated><id>https://movingwoo.com/server/2025/09/11/Build%20Server%20MK3</id><content type="html" xml:base="https://movingwoo.com/server/2025/09/11/Build-Server-MK3.html"><![CDATA[<blockquote>
  <h4 id="들어가기-앞서">들어가기 앞서</h4>
  <hr />
</blockquote>

<p>서버 1호기와 2호기를 운영 중 이상이 생겼다.</p>

<p>1호기는 서피스 윈도우를 밀어버리고 우분투를 올렸는데<br />
뭐가 문제인지 며칠 지나면 멋대로 <span style="color: red;"><strong>‘죽을게’</strong></span>를 외치고 꺼져버린다.<br />
왜 이러는거야…</p>

<p>2호기는 오라클 클라우드에서 40평형 궁궐같은 집을 무료로 임대받아 살았는데<br />
리전이 한국이 아니라 일본이라 사소한 이슈가 조금 있었고<br />
이를 해결하기 위한 오라클과의 불통 끝에 서버 접근도 안되고 탈퇴도 안되는 불법체류자 같은 존재가 되었다.</p>

<p>3호기 서버가 절실한 상황, 서버를 새로 구축한다.</p>

<blockquote>
  <h4 id="3호기-설계">3호기 설계</h4>
  <hr />
</blockquote>

<p>무료로 제공하는 VM 서비스를 찾아보면, 사실 오라클 클라우드를 제외하면 마땅한 후보가 존재치 않는다.<br />
기간 제한이 있거나 용량이 너무 적다.<br />
돈 만원이라도 넣어야 사용할만한 공간이 나오는데 무료가 아니라 아쉬운게 사실.</p>

<p>결국 물리 서버 하나 집구석에 던져두고 공유기 물려두는게 제일 저렴하다.<br />
3호기에 서비스를 올려서 테스트용으로 가볍게 사용할거라 네트워크 이슈가 생길 일도 없다.</p>

<p>다행히도 뽀얗게 먼지쌓인 데스크탑 한 대가 있다.</p>

<p>뭔가 램도 꽂혀있고 그래픽카드도 달려있는데… 모델 명을 모르겠다.<br />
6 ~ 7년은 지난 터라 구매기록도 못찾겠다.</p>

<p>다른 부품은 다 있고 SSD만 뽑아간 탓에 SSD 연결하면 사용에는 이상이 없을 것 같다.<br />
M.2 슬롯이 없는 것 같으니 SATA SSD 500gb 로 주문하자.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img01.webp" alt="img01" /></p>

<p>배송비 포함 8만원<br />
PC 부품이 워낙 싯가로 널뛰기를 하기 때문에 싼지 비싼지 가늠이 안간다.<br />
쓸 돈은 써야지 뭐…</p>

<blockquote>
  <h4 id="3호기-구축">3호기 구축</h4>
  <hr />
</blockquote>

<h5 id="1-본체-확인">1. 본체 확인</h5>

<p>나는 하드웨어 쪽은 잘 모르지만, PC 조립은 레고의 그것과 같다고 들었다.</p>

<p><span style="color: orange;"><strong>구멍이 맞는가?</strong></span><br />
<span style="color: orange;"><strong>큰 힘 없이 끼워지는가?</strong></span><br />
<span style="color: red;"><strong>거기가 맞으니 끼워라</strong></span></p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img02.webp" alt="img02" /></p>

<p>이렇게 하면 되겠지?<br />
대충 남는 공간에 쑤셔박고 파워를 물리면 끝</p>

<h5 id="2-부팅-디스크-준비">2. 부팅 디스크 준비</h5>

<p><span style="color: orange;"><strong>rufus</strong></span>를 이용하여 usb를 부팅디스크로 만든다.<br />
ventoy 였나? 그걸 쓰는 경우도 있다는데 나는 익숙한 rufus를 쓰기로 했다.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img03.webp" alt="img03" /></p>

<p><a href="https://ubuntu.com/download/server">Ubuntu Server Download</a></p>

<p>공식홈페이지에서 다운로드 받아 부팅 드라이브를 만든다.</p>

<p>여기서 <span style="color: orange;"><strong>우분투 데스크탑</strong></span>을 사용할지, <span style="color: orange;"><strong>우분투 서버</strong></span>를 사용할지 결정을 해야하는데 나는 서버를 선택했다.<br />
모니터와 키보드 없이 전원만 붙여놓을 생각이기 때문이며, 서버는 인터넷 없는 환경에서 <span style="color: orange;"><strong>OpenSSH를 사전 설치</strong></span> 가능하다.<br />
우선 인터넷 없는 환경에서 설치 후 자리를 옮길거라 서버가 적절한 옵션이다.</p>

<p>데스크탑과 서버의 차이는 대략 아래와 같다.</p>

<table>
  <thead>
    <tr>
      <th>항목</th>
      <th>Ubuntu Desktop</th>
      <th>Ubuntu Server</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>GUI</strong></td>
      <td>O</td>
      <td>X</td>
    </tr>
    <tr>
      <td><strong>기본 설치 패키지</strong></td>
      <td>파폭, 리브레오피스 등</td>
      <td>openssh, apache 등</td>
    </tr>
    <tr>
      <td><strong>자원 사용량</strong></td>
      <td>상대적으로 무거움</td>
      <td>상대적으로 가벼움</td>
    </tr>
    <tr>
      <td><strong>보안 정책</strong></td>
      <td>개인 사용자 보안 중심 (방화벽 off 기본)</td>
      <td>서버 보안 중심 (SSH 접근, UFW 설정 등 적극 권장)</td>
    </tr>
    <tr>
      <td><strong>업데이트 주기</strong></td>
      <td>데스크탑 중심 패키지 포함 (예: 그래픽 드라이버, 오피스 등)</td>
      <td>서버 안정성·장기 지원 중심 (서비스 지향)</td>
    </tr>
  </tbody>
</table>

<p>초기화 시 iso로 할지 dd로 할지 묻는데 <span style="color: orange;"><strong>dd</strong></span>로 진행하면 된다.<br />
일부 환경에서 iso usb가 인식이 잘 안될수도 있다고, 그대로 복제를 한 dd 이미지가 안정적이라고 한다.</p>

<h5 id="3-os-설치">3. OS 설치</h5>

<p>usb로 부팅 후 하라는 대로 엔터치면서 설치하면 끝인데…<br />
여기서 한가지 문제 발생<br />
<span style="color: red;"><strong>The install media checksum verification failed</strong></span> 라는 오류가 뜨며 진행할 수 없다.</p>

<p>일반적으로 usb를 잘못 구웠거나 다운로드가 잘못되었을 경우 발생한다는데…<br />
하드웨어가 잘못되었을 가능성도 있기 때문에 데스크탑 버전으로 한 번 설치를 시도한다.<br />
결과는 성공.</p>

<p>데스크탑 설치는 문제없으니 하드웨어 이상은 아닐거로 판단, 하위버전을 설치해본다.<br />
24.04 말고 22.04 버전으로 새로 다운로드 받아서 설치하니 성공.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img04.webp" alt="img04" /></p>

<p><strong>acquiring and extracting image</strong> 부분에서 오류 발생 후 셧다운 됐었는데<br />
이상없이 시스템 설치가 진행된다.</p>

<h5 id="4-세팅">4. 세팅</h5>

<p>인터넷이 연결되면 우선 업데이트를 진행한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img05.webp" alt="img05" /></p>

<p>시간대 설정 후 ufw에 ssh 포트를 세팅한다.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img06.webp" alt="img06" /></p>

<p>보안 상 22번 포트를 그대로 노출하는건 별로다.<br />
추후 22번 포트 자체를 다른 포트로 변경할텐데 우선은 공유기 포트 포워딩 설정에서 외부 포트를 다른 포트로 지정하고 내부 22번 포트로 연결한다.</p>

<p>ssh 접속 테스트 진행</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img07.webp" alt="img07" /></p>

<p>이제 연결해둔 모니터와 키보드를 제거하고 전원만 켜두면 된다.</p>

<blockquote>
  <h4 id="앞으로-해야할-것">앞으로 해야할 것</h4>
  <hr />
</blockquote>

<p>오랜만에 서버 구축하니까 재미있다.</p>

<p>24.04로 업그레이드는 당장 필요치 않으니 제외하고<br />
<span style="color: orange;"><strong>보안 설정</strong></span>을 우선적으로 진행하고<br />
도커와 같은 필수 툴을 설치하고<br />
개인 설정을 진행해야한다.</p>

<p>그러고보니 보드가 뭔지 그래픽카드는 뭔지 정보를 아무것도 모르고 일단 올렸는데 이제 확인해보자.</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img08.webp" alt="img08" /><br />
<img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img09.webp" alt="img09" /><br />
<img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img10.webp" alt="img10" /></p>

<p>그래픽카드의 경우 명확히는 안나오는데 아마 기억이 맞다면 rx 570쯤 될거다.<br />
이 서버엔 너무나 과분한 그래픽카드가 아닐 수 없다.</p>

<p>메인보드가 MSI B450M 인데…</p>

<p><img src="/assets/images/posts/Server/2025-09-11-Build Server MK3/img11.webp" alt="img11" /></p>

<p><span style="color: red;"><strong>뭐야 M.2 슬롯이 있었다고?</strong></span></p>]]></content><author><name>movingwoo</name></author><category term="Server/" /><category term="SERVER" /><category term="ubuntu" /><category term="구축" /><summary type="html"><![CDATA[3호기 개인 우분투 서버 구축]]></summary></entry><entry><title type="html">마리아디비 설치</title><link href="https://movingwoo.com/development/shellscript/2025/08/04/Install-MariaDB.html" rel="alternate" type="text/html" title="마리아디비 설치" /><published>2025-08-04T07:00:00+00:00</published><updated>2025-08-04T07:00:00+00:00</updated><id>https://movingwoo.com/development/shellscript/2025/08/04/Install%20MariaDB</id><content type="html" xml:base="https://movingwoo.com/development/shellscript/2025/08/04/Install-MariaDB.html"><![CDATA[<blockquote>
  <h4 id="개요">개요</h4>
  <hr />
</blockquote>

<p>일반적인 리눅스 환경에서 마리아디비 설치가 필요한 경우 rpm으로 설치한다.<br />
간편하고 빠르다.</p>

<p>하지만 rpm을 쓸 수 없는 특수한 환경에서는 어떡하지?<br />
구글링하면서 공부하다가 자동화 스크립트 만들 수 있을 것 같아서 만든다.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p><a href="https://mariadb.org/download/">MariaDB Foundation Download</a></p>

<p>설치할 마리아디비 tarball 파일은 공식홈페이지에서 구할 수 있다.</p>

<p>tar 파일 이용해 설치 진행 시 내용을 간단히 요약해보자면</p>
<ol>
  <li><span style="color: orange;"><strong>파일들을 적당히 경로로 옮긴다.</strong></span></li>
  <li><span style="color: orange;"><strong>데이터베이스 초기화 스크립트를 수행한다.</strong></span></li>
  <li><span style="color: orange;"><strong>기동!!</strong></span></li>
</ol>

<p>써놓고 보면 아주 단순한데 막상 해보면 이상한 오류가 나기도 하고<br />
알 수 없는 억까의 세계</p>

<p>일단 커맨드 자체는 아주 단순한 편들이라 스크립트화 가능하다.</p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<h5 id="1-환경변수와-사용법-함수">1. 환경변수와 사용법 함수</h5>

<p>rpm으로 설치해보면 <span style="color: orange;"><strong>mysql</strong></span> 계정이 디폴트다.<br />
다른 계정을 쓸 수 있으니 그룹과 계정을 변수로 뺀다.</p>

<p><span style="color: orange;"><strong>TAR</strong></span> 파일 경로는 당연히 옵션화 해야하며<br />
<span style="color: orange;"><strong>/usr/local</strong></span> 하위 설치를 디폴트로 두고 변수화한다.</p>

<p>사용 시 설치를 리트라이할 수 있는데 이때를 위해 데이터를 삭제하는 옵션을 넣어준다.<br />
<span style="color: orange;"><strong>RESET</strong></span> 옵션은 삭제 후 재설치, <span style="color: orange;"><strong>CLEAN</strong></span> 옵션은 삭제만 하는 것으로 한다.</p>

<p>그냥 스크립트 호출하는 순간 설치가 진행되는 것도 위험하기 때문에 <span style="color: orange;"><strong>INSTALL</strong></span> 옵션을 넣어준다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 기본 변수</span>
<span class="nv">GROUP</span><span class="o">=</span><span class="s2">"mysql"</span>
<span class="nv">USER</span><span class="o">=</span><span class="s2">"mysql"</span>
<span class="nv">TAR_FILE</span><span class="o">=</span><span class="s2">"/home/app/mariadb-10.11.13-linux-systemd-x86_64.tar.gz"</span>
<span class="nv">INSTALL_PREFIX</span><span class="o">=</span><span class="s2">"/usr/local"</span>
<span class="nv">INSTALL_DIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">/mariadb"</span>
<span class="nv">RESET</span><span class="o">=</span><span class="nb">false
</span><span class="nv">CLEAN_ONLY</span><span class="o">=</span><span class="nb">false
</span><span class="nv">INSTALL</span><span class="o">=</span><span class="nb">false</span>

<span class="c"># 옵션 파싱</span>
<span class="k">while</span> <span class="o">[[</span> <span class="nv">$# </span><span class="nt">-gt</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">do
  case</span> <span class="nv">$1</span> <span class="k">in</span>
    <span class="nt">-i</span><span class="p">|</span><span class="nt">--install</span><span class="p">)</span>    <span class="nv">INSTALL</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span> <span class="nb">shift</span><span class="p">;;</span>
    <span class="nt">-r</span><span class="p">|</span><span class="nt">--reset</span><span class="p">)</span>      <span class="nv">RESET</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span> <span class="nb">shift</span><span class="p">;;</span>
    <span class="nt">-c</span><span class="p">|</span><span class="nt">--clean</span><span class="p">)</span>      <span class="nv">CLEAN_ONLY</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span> <span class="nb">shift</span><span class="p">;;</span>
    <span class="nt">-h</span><span class="p">|</span><span class="nt">--help</span><span class="p">)</span>       usage<span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>               <span class="nb">echo</span> <span class="s2">"Unknown option: </span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> usage<span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div></div>

<p>옵션 없이 스크립트를 호출하거나, -h 옵션을 넣을 경우에는 도움말을 보여주도록 한다.<br />
<span style="color: red;"><strong>이런 거 무시하고 안넣으면 나중에 나도 까먹어서 사용할 수 없다…</strong></span></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 사용법 함수</span>
usage<span class="o">()</span> <span class="o">{</span>
  <span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
Usage: sudo </span><span class="nv">$0</span><span class="sh"> [options]

Options:
  -i, --install     Install MariaDB
                    마리아디비 설치
  -r, --reset       Reset data before installing (remove then reinstall)
                    데이터 초기화 후 설치 (삭제 후 재설치)
  -c, --clean       Clean only (remove data without reinstalling)
                    초기화만 (재설치 없이 삭제)
  -h, --help        Show this help message and exit
                    도움말
</span><span class="no">EOF
</span>  <span class="nb">exit </span>1
<span class="o">}</span>
</code></pre></div></div>

<h5 id="2-설치-전-조건과-초기화-조건">2. 설치 전 조건과 초기화 조건</h5>

<p>관리자 권한이 필요해 <span style="color: orange;"><strong>root 권한</strong></span>을 체크한다.<br />
RESET 옵션과 CLEAN 옵션이 충돌하면 난리날거라 그 부분도 확인하고<br />
CLEAN을 지정했을 경우 삭제 후 프로세스를 종료하도록 설정한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># root 권한 확인</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$EUID</span><span class="s2">"</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"[ERROR] root 권한으로 실행해야 함"</span> <span class="o">&gt;</span>&amp;2
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># -r 과 -c 충돌 확인</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$RESET</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CLEAN_ONLY</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"[ERROR] -r 과 -c 옵션은 함께 사용 불가"</span> <span class="o">&gt;</span>&amp;2
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># 아무 옵션도 안걸면 -h로 수행</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$INSTALL</span><span class="s2">"</span> <span class="o">!=</span> <span class="nb">true</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$RESET</span><span class="s2">"</span> <span class="o">!=</span> <span class="nb">true</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CLEAN_ONLY</span><span class="s2">"</span> <span class="o">!=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span>usage
<span class="k">fi</span>

<span class="c"># 초기화 (reset 또는 clean)</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$RESET</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CLEAN_ONLY</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"=== MariaDB 초기화 시작 ==="</span>
  systemctl stop mariadb <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="nb">true
  </span>systemctl disable mariadb <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="nb">true
  rm</span> <span class="nt">-f</span> /etc/systemd/system/mariadb.service
  systemctl daemon-reload <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="nb">true
  rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span>
  <span class="nb">rm</span> <span class="nt">-f</span> /etc/profile.d/mariadb.sh
  <span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">/mysql"</span>
  <span class="nb">echo</span> <span class="s2">"=== 초기화 완료: 설치 디렉터리, 서비스 파일, 환경변수, 링크 제거 ==="</span>

  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CLEAN_ONLY</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">exit </span>0
  <span class="k">fi
fi</span>
</code></pre></div></div>

<h5 id="3-설치">3. 설치</h5>

<p>설치 커맨드를 나열하는 단계.</p>

<p>마리아디비가 마이에스큐엘의 아종이다보니 헷갈리는 부분이 많았다.<br />
mysql 이름의 폴더를 기본 설정으로 찾는 경우가 많아서 <span style="color: orange;"><strong>심볼릭 링크</strong></span>를 생성해 오류를 피하고<br />
<span style="color: orange;"><strong>데이터베이스 초기화 파일</strong></span>도 mariadb~~ 인 경우가 있고 mysql~~ 인 경우가 있어서 뭐라도 있으면 찾아서 쓰도록 하였다.</p>

<p>실제 이리저리 시도해보다 온갖 오류가 나길래 이 단계에서의 관건은 실패 시 해결책을 같이 써두는 것으로 하였다.<br />
<span style="color: orange;"><strong>ERROR</strong></span> 태그 출력 시 가능하면 <span style="color: orange;"><strong>HOW TO FIX</strong></span> 태그와 함께 수동으로 문제를 확인해볼 수 있게 한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 설치</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$INSTALL</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$RESET</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>

  <span class="c"># 그룹/사용자 생성</span>
  getent group <span class="s2">"</span><span class="nv">$GROUP</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null <span class="o">||</span> groupadd <span class="s2">"</span><span class="nv">$GROUP</span><span class="s2">"</span>
  getent passwd <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null <span class="o">||</span> useradd <span class="nt">-r</span> <span class="nt">-g</span> <span class="s2">"</span><span class="nv">$GROUP</span><span class="s2">"</span> <span class="nt">-s</span> /bin/false <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span>

  <span class="c"># 압축 해제</span>
  <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$TAR_FILE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"[ERROR] '</span><span class="nv">$TAR_FILE</span><span class="s2">' 파일을 찾을 수 없음"</span> <span class="o">&gt;</span>&amp;2
    <span class="nb">echo</span> <span class="s2">"[HOW TO FIX] TAR_FILE 경로와 이름이 정확한지 확인."</span>
    <span class="nb">exit </span>1
  <span class="k">fi

  </span><span class="nb">echo</span> <span class="s2">"[INFO] '</span><span class="nv">$TAR_FILE</span><span class="s2">' 압축 해제 중..."</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">"</span>
  <span class="nb">tar</span> <span class="nt">-xzf</span> <span class="s2">"</span><span class="nv">$TAR_FILE</span><span class="s2">"</span> <span class="nt">-C</span> <span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"[SUCCESS] '</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">' 아래 디렉터리 압축 해제 완료"</span>

  <span class="c"># 디렉터리 위치 조정</span>
  <span class="nv">EX_DIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">tar</span> <span class="nt">-tf</span> <span class="s2">"</span><span class="nv">$TAR_FILE</span><span class="s2">"</span> | <span class="nb">head</span> <span class="nt">-1</span> | <span class="nb">cut</span> <span class="nt">-f1</span> <span class="nt">-d</span><span class="s2">"/"</span><span class="si">)</span>
  <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">/</span><span class="nv">$EX_DIR</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"[SUCCESS] '</span><span class="nv">$INSTALL_DIR</span><span class="s2">'로 이동 완료"</span>

  <span class="c"># 링크 생성</span>
  <span class="nb">ln</span> <span class="nt">-sfn</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">/mysql"</span>
  <span class="nb">echo</span> <span class="s2">"[SUCCESS] '</span><span class="nv">$INSTALL_PREFIX</span><span class="s2">/mysql' 심볼릭 링크 '</span><span class="nv">$INSTALL_DIR</span><span class="s2">' 생성 완료"</span>

  <span class="c"># 권한 설정</span>
  <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> mysql-files data
  <span class="nb">chown</span> <span class="nt">-R</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span>:<span class="s2">"</span><span class="nv">$GROUP</span><span class="s2">"</span> <span class="nb">.</span>
  <span class="nb">chmod </span>750 mysql-files
  <span class="nb">echo</span> <span class="s2">"[SUCCESS] mysql-files, data 디렉터리 권한 변경 완료"</span>

  <span class="c"># 데이터베이스 초기화</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-x</span> <span class="s2">"bin/mariadb-install-db"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>bin/mariadb-install-db <span class="se">\</span>
      <span class="nt">--user</span><span class="o">=</span><span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--basedir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--datadir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">/data"</span>
    <span class="nb">echo</span> <span class="s2">"[SUCCESS] bin/mariadb-install-db로 데이터베이스 초기화 완료"</span>

  <span class="k">elif</span> <span class="o">[</span> <span class="nt">-x</span> <span class="s2">"scripts/mysql_install_db"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>scripts/mysql_install_db <span class="se">\</span>
      <span class="nt">--user</span><span class="o">=</span><span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--basedir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--datadir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">/data"</span>
    <span class="nb">echo</span> <span class="s2">"[SUCCESS] scripts/mysql_install_db로 데이터베이스 초기화 완료"</span>

  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"[ERROR] 초기화 스크립트를 찾을 수 없음, 수동 초기화 필요"</span> <span class="o">&gt;</span>&amp;2
    <span class="nb">echo</span> <span class="s2">"[HOW TO FIX]"</span>
    <span class="nb">echo</span> <span class="s2">"  1) </span><span class="nv">$INSTALL_DIR</span><span class="s2">/bin 또는 </span><span class="nv">$INSTALL_DIR</span><span class="s2">/scripts 경로 확인"</span>
    <span class="nb">echo</span> <span class="s2">"  2) 해당 경로에서 mysql_install_db 또는 mariadb-install-db 실행"</span>
    <span class="nb">echo</span> <span class="s2">"  3) 설정 완료 후 'systemctl start mariadb' 재시도"</span>
  <span class="k">fi</span>

  <span class="c"># 환경변수 등록</span>
  <span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; /etc/profile.d/mariadb.sh
export PATH=</span><span class="nv">$INSTALL_DIR</span><span class="sh">/bin:</span><span class="se">\$</span><span class="sh">PATH
</span><span class="no">EOF
</span>  <span class="nb">chmod</span> +x /etc/profile.d/mariadb.sh
  <span class="nb">echo</span> <span class="s2">"[SUCCESS] /etc/profile.d/mariadb.sh 생성 및 권한 변경 완료"</span>
<span class="k">fi</span>
</code></pre></div></div>

<h5 id="4-나머지-과정">4. 나머지 과정</h5>

<p>rpm으로 설치해보면 systemctl로 컨트롤 할 수 있게 올라간다.<br />
요즘에 <span style="color: orange;"><strong>systemd</strong></span> 안쓰는 리눅스가 어디있냐! 하느냐면<br />
당장 도커 컨테이너로 올리면 systemd 쓰기가 녹록치 않다.</p>

<p>때문에 분기로 systemd 여부를 체크하고 있으면 등록, 없으면 mysqld_safe 기동 후 크론탭에 자동 등록하도록 한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># systemd 존재할 경우 서비스 설정 및 시작, 없으면 mysqld_safe 실행 후 크론 등록</span>
<span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> systemctl <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nt">-d</span> /run/systemd/system <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">IS_SYSTEMD</span><span class="o">=</span><span class="nb">true
</span><span class="k">else
  </span><span class="nv">IS_SYSTEMD</span><span class="o">=</span><span class="nb">false
</span><span class="k">fi

</span><span class="nv">SERVICE_SRC</span><span class="o">=</span><span class="si">$(</span>find <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-name</span> mariadb.service | <span class="nb">head</span> <span class="nt">-n1</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$IS_SYSTEMD</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span><span class="k">then
  if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SERVICE_SRC</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"[INFO] 서비스 설정"</span>
    <span class="nb">cp</span> <span class="s2">"</span><span class="nv">$SERVICE_SRC</span><span class="s2">"</span> /etc/systemd/system/mariadb.service
    <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|/usr/local/mysql|</span><span class="nv">$INSTALL_DIR</span><span class="s2">|g"</span> /etc/systemd/system/mariadb.service
    systemctl daemon-reload
    systemctl <span class="nb">enable </span>mariadb
    systemctl start mariadb <span class="o">||</span> <span class="nb">true
    echo</span> <span class="s2">"[SUCCESS] 서비스 시작 완료, 상태확인: systemctl status mariadb"</span>

  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"[ERROR] mariadb.service 파일을 찾을 수 없음"</span> <span class="o">&gt;</span>&amp;2
      <span class="nb">echo</span> <span class="s2">"[HOW TO FIX]"</span>
      <span class="nb">echo</span> <span class="s2">"  1) 설치 디렉터리에서 service 파일 검색: find </span><span class="nv">$INSTALL_DIR</span><span class="s2"> -type f -name mariadb.service"</span>
      <span class="nb">echo</span> <span class="s2">"  2) 해당 파일을 /etc/systemd/system/ 디렉터리에 복사: sudo cp &lt;경로&gt; /etc/systemd/system/mariadb.service"</span>
      <span class="nb">echo</span> <span class="s2">"  3) systemd 다시 로드 및 서비스 활성화/시작:"</span>
      <span class="nb">echo</span> <span class="s2">"       sudo systemctl daemon-reload"</span>
      <span class="nb">echo</span> <span class="s2">"       sudo systemctl enable mariadb"</span>
      <span class="nb">echo</span> <span class="s2">"       sudo systemctl start mariadb"</span>
      <span class="nb">exit </span>1
  <span class="k">fi
else
  </span><span class="nb">echo</span> <span class="s2">"[INFO] 크론 설정"</span>
  <span class="nb">sudo</span> <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">/bin/mysqld_safe"</span> <span class="se">\</span>
      <span class="nt">--basedir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--datadir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">/data"</span> <span class="o">&gt;</span> /var/log/mariadb.log 2&gt;&amp;1 &amp;

  <span class="o">(</span>
    crontab <span class="nt">-l</span> 2&gt;/dev/null <span class="se">\</span>
    | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nt">-F</span> <span class="s2">"</span><span class="nv">$INSTALL_DIR</span><span class="s2">/bin/mysqld_safe"</span> <span class="o">||</span> <span class="nb">true
    echo</span> <span class="s2">"@reboot sudo -u </span><span class="nv">$USER</span><span class="s2"> </span><span class="nv">$INSTALL_DIR</span><span class="s2">/bin/mysqld_safe --basedir=</span><span class="nv">$INSTALL_DIR</span><span class="s2"> --datadir=</span><span class="nv">$INSTALL_DIR</span><span class="s2">/data &gt;&gt; /var/log/mariadb.log 2&gt;&amp;1 &amp;"</span>
  <span class="o">)</span> | crontab -

  <span class="nb">echo</span> <span class="s2">"[SUCCESS] mysqld_safe 시작 완료, 크론 등록 완료"</span>
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"=== MariaDB 설치 및 서비스 구동 완료 ==="</span>
<span class="nb">echo</span> <span class="s2">"DB 접속할 계정에서 1회만 실행: source /etc/profile.d/mariadb.sh"</span>
<span class="nb">echo</span> <span class="s2">"접속: mysql -u root"</span>
</code></pre></div></div>

<blockquote>
  <h4 id="완성">완성</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/Development/ShellScript/2025-08-04-Install MariaDB/img01.webp" alt="img01" /></p>

<p>이후 계정 생성이나 튜닝이나 기타 등등은 재주껏 하는 것</p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>생각해보니 크론탭 등록 분기 추가했으면 삭제 시 크론도 삭제해야하는데 빼먹었다!!!<br />
아 이제와서 손대기 귀찮으니 다음에 사고나면 고쳐보자.</p>

<p>OS는 유닉스를 가져오지 않는 이상 웬만하면 돌아갈 것 같다.<br />
버전도 10 버전, 11버전만 써보긴 했는데 뭐 크게 바뀌는거 아니면 웬만하면 돌아가지 않을까?</p>

<p>이 스크립트가 안돌아갈 정도로 버전이 바뀌면 어차피 나도 이 스크립트의 존재를 까먹고 지낼 것 같긴 하다.</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/Development/ShellScript/2025-08-04-Install%20MariaDB.sh">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="Development/ShellScript/" /><category term="SHELL" /><category term="마리아디비 설치" /><summary type="html"><![CDATA[마리아디비 설치 스크립트 개발]]></summary></entry><entry><title type="html">9548번 무제</title><link href="https://movingwoo.com/boj/c++/2025/07/07/9548.html" rel="alternate" type="text/html" title="9548번 무제" /><published>2025-07-07T06:00:00+00:00</published><updated>2025-07-07T06:00:00+00:00</updated><id>https://movingwoo.com/boj/c++/2025/07/07/9548</id><content type="html" xml:base="https://movingwoo.com/boj/c++/2025/07/07/9548.html"><![CDATA[<blockquote>
  <h4 id="이왜틀">이왜틀?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/C++/2025-07-07-9548/img01.webp" alt="img01" /></p>

<p><a href="https://www.acmicpc.net/problem/9548">9548번 무제 - 백준</a></p>

<p>아… 진짜 풀기 싫게 생긴 문제인데<br />
왜 이런 문제에 손을 대서 틀려놔가지고…<br />
코드 볼 필요는 없을 것 같고 천천히 풀어보자.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p>I 는 X 에 R 을 삽입한다.<br />
P는 X 부터 Y 까지 출력한다.</p>

<p>여기까지는 단순한데 문제 제한시간이 10초인거 보면 입력량이 보통이 아닐 것이다.</p>

<p><span style="color: orange;"><strong>문자열을 트리처럼 관리하는 Rope</strong></span>라는 자료구조가 있다고 한다.<br />
문제 분류도 Rope로 되어있고 그걸 공부해야 할 것 같은데…<br />
개념을 이해하는 것과 구현은 또 다른 문제.</p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<p>처음부터 구현하는데 와 머리가 너무 아파서 때려치고 싶던 차<br />
GNU 확장 STL로 rope가 있다는 것을 알게 되었다.<br />
GCC 기반이면 된다고 하는데 BOJ가 요녀석을 소화할 수 있을까?</p>

<p>헤더는 다음과 같이 사용한다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;ext/rope&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">__gnu_cxx</span><span class="p">;</span>
</code></pre></div></div>

<p>이제 <span style="color: orange;"><strong>__gnu_cxx::rope</strong></span>를 사용할 수 있다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">T</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">T</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">ignore</span><span class="p">();</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">T</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>

        <span class="c1">// rope</span>
        <span class="n">rope</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">rope</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

        <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s">"END"</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

            <span class="n">stringstream</span> <span class="n">ss</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="n">string</span> <span class="n">query</span><span class="p">;</span>
            <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">query</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">query</span> <span class="o">==</span> <span class="s">"I"</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// insert</span>
                <span class="n">string</span> <span class="n">x</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
                <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span>
                <span class="n">rope</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">query</span> <span class="o">==</span> <span class="s">"P"</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// print</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
                <span class="n">ss</span> <span class="o">&gt;&gt;</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rope</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <h4 id="채점">채점</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/C++/2025-07-07-9548/img02.webp" alt="img02" /></p>

<p>이게 되네</p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>정말 뇌가 녹아내리는 줄<br />
며칠 더 시간 투자했으면 직접 구현 가능했을 것 같긴 한데<br />
간단하게 넘어가는게 좋지… 좋은게 좋지</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/BOJ/C%2B%2B/2025-07-07-9548.cpp">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="BOJ/C++/" /><category term="C++" /><category term="알고리즘" /><category term="백준" /><category term="9548" /><category term="무제" /><category term="로프" /><summary type="html"><![CDATA[백준 9548번 무제 C++ 문제풀이]]></summary></entry><entry><title type="html">12837번 가계부 (Hard)</title><link href="https://movingwoo.com/boj/python/2025/07/03/12837.html" rel="alternate" type="text/html" title="12837번 가계부 (Hard)" /><published>2025-07-03T06:00:00+00:00</published><updated>2025-07-03T06:00:00+00:00</updated><id>https://movingwoo.com/boj/python/2025/07/03/12837</id><content type="html" xml:base="https://movingwoo.com/boj/python/2025/07/03/12837.html"><![CDATA[<blockquote>
  <h4 id="이왜틀">이왜틀?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-12837/img01.webp" alt="img01" /></p>

<p><a href="https://www.acmicpc.net/problem/12837">12837번 가계부 (Hard) - 백준</a></p>

<p>이왜틀 마지막 골드 문제<br />
솔직히 이건 소스 볼 필요도 없다.<br />
Hard라는건 Easy도 있다는 말이고<br />
아마 과거의 내가 Easy를 풀고 소스 그대로 Hard에 집어넣어서 시간초과 났을 것이다.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p>대충 구간합 구하는데 값 변경이 필요함 == <span style="color: orange;"><strong>세그먼트 트리</strong></span></p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<h5 id="1-세그먼트-트리-구현">1. 세그먼트 트리 구현</h5>

<p>update와 query로 구성된 정석적인 세그먼트 트리 클래스를 구현한다.<br />
값 갱신이 아니라 <span style="color: orange;"><strong>숫자를 합</strong></span>하는 것에 주의</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SegmentTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span> 

        <span class="k">while</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">n</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="n">self</span><span class="p">.</span><span class="n">tree</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        <span class="c1"># 갱신이 아니라 합치기
</span>        <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>

        <span class="k">while</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">//=</span> <span class="mi">2</span> 
            <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">l</span> <span class="o">//=</span> <span class="mi">2</span>
            <span class="n">r</span> <span class="o">//=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h5 id="2-쿼리-수행">2. 쿼리 수행</h5>

<p>입력받아 쿼리를 수행한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">N</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nf">input</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span>
<span class="n">tree</span> <span class="o">=</span> <span class="nc">SegmentTree</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">Q</span><span class="p">):</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nf">input</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span>

    <span class="c1"># 1은 업데이트 2는 구간합
</span>    <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tree</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<blockquote>
  <h4 id="채점">채점</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-12837/img02.webp" alt="img02" /></p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>골드도 끝났고 플래티넘 문제 2개가 남았다.<br />
이건 각오하고 접근해야지…</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/BOJ/Python/2025-07-03-12837.py">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="BOJ/Python/" /><category term="PYTHON" /><category term="알고리즘" /><category term="백준" /><category term="12837" /><category term="가계부 (Hard)" /><category term="세그먼트트리" /><summary type="html"><![CDATA[백준 12837번 가계부 (Hard) PYTHON 문제풀이]]></summary></entry><entry><title type="html">16455번 K번째 수 찾는 함수</title><link href="https://movingwoo.com/boj/python/2025/07/03/16455.html" rel="alternate" type="text/html" title="16455번 K번째 수 찾는 함수" /><published>2025-07-03T04:00:00+00:00</published><updated>2025-07-03T04:00:00+00:00</updated><id>https://movingwoo.com/boj/python/2025/07/03/16455</id><content type="html" xml:base="https://movingwoo.com/boj/python/2025/07/03/16455.html"><![CDATA[<blockquote>
  <h4 id="이왜틀">이왜틀?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-16455/img01.webp" alt="img01" /></p>

<p><a href="https://www.acmicpc.net/problem/16455">16455번 K번째 수 찾는 함수 - 백준</a></p>

<p>함수를 직접 구현하는 문제.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">end</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="n">k</span><span class="o">-=</span><span class="mi">1</span><span class="o">;</span>

<span class="k">while</span><span class="o">(</span><span class="n">start</span><span class="o">&lt;</span><span class="n">end</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">start</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">end</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">=</span><span class="n">a</span><span class="o">[(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">)/</span><span class="mi">2</span><span class="o">];</span>
    
    <span class="k">while</span><span class="o">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">j</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]&gt;=</span><span class="n">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
            <span class="n">a</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
            <span class="n">j</span><span class="o">--;</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="n">i</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]&gt;</span><span class="n">mid</span><span class="o">)</span> <span class="n">i</span><span class="o">--;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">i</span><span class="o">)</span> <span class="n">end</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
    <span class="k">else</span> <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">a</span><span class="o">[</span><span class="n">k</span><span class="o">];</span>
</code></pre></div></div>

<p><span style="color: orange;"><strong>퀵셀렉트</strong></span>를 했는데 시간초과가 났다.<br />
조금만 수정하면 통과할 수 있다.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p>java 코드에서 pivot을 중앙 값으로 설정했다.<br />
그런데 찾는 값이 한쪽으로 치우치면 시간 복잡도가 O(N^2) 까지 갈 수 있다.</p>

<p>만약 <span style="color: orange;"><strong>pivot을 무작위 난수</strong></span>를 생성해 선택하면 한쪽으로 치우치는걸 다소 방지할 수 있다.<br />
그리고 수열의 요소가 서로 다른 값임이 보장되지 않는다.<br />
이 부분에 대한 로직도 추가한다.</p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<p>pivot은 start와 end 사이 랜덤으로 설정한다.<br />
중복값인 경우 정확한 판단을 위해 pivot을 기준으로 <span style="color: orange;"><strong>3분할</strong></span>한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">kth</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="kn">import</span> <span class="n">random</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span> 
        <span class="c1"># 3분할
</span>        <span class="n">i</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">end</span>

        <span class="c1"># 무작위 값
</span>        <span class="n">pivot</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)]</span>

        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">:</span>
            <span class="c1"># pivot보다 작을때
</span>            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># pivot보다 클떄
</span>            <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pivot</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">l</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pivot</span>
</code></pre></div></div>

<blockquote>
  <h4 id="채점">채점</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-16455/img02.webp" alt="img02" /></p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>좀 빡쎘다…<br />
옛날 코드 잘 해놔서 그대로 포팅하면 쉽게 날먹할 줄 알았는데</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/BOJ/Python/2025-07-03-16455.py">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="BOJ/Python/" /><category term="PYTHON" /><category term="알고리즘" /><category term="백준" /><category term="16455" /><category term="K번째 수 찾는 함수" /><category term="퀵셀렉트" /><summary type="html"><![CDATA[백준 16455번 K번째 수 찾는 함수 PYTHON 문제풀이]]></summary></entry><entry><title type="html">2252번 줄 세우기</title><link href="https://movingwoo.com/boj/python/2025/07/03/2252.html" rel="alternate" type="text/html" title="2252번 줄 세우기" /><published>2025-07-03T02:00:00+00:00</published><updated>2025-07-03T02:00:00+00:00</updated><id>https://movingwoo.com/boj/python/2025/07/03/2252</id><content type="html" xml:base="https://movingwoo.com/boj/python/2025/07/03/2252.html"><![CDATA[<blockquote>
  <h4 id="이왜틀">이왜틀?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-2252/img01.webp" alt="img01" /></p>

<p><a href="https://www.acmicpc.net/problem/2252">2252번 줄 세우기 - 백준</a></p>

<p>런타임 에러가 났고 코드가 너무 길어서 안가져오기로 했다.<br />
대충 리스트에 넣고 빼면서 시뮬레이션 하는 내용이다.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p><span style="color: orange;"><strong>위상정렬</strong></span>을 한다.</p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<p>대충 그래프 그리고, 진입차수가 0인 노드를 큐에 모으고, 연결된 노드 진입차수 감소시킨다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nf">input</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span>

<span class="c1"># 그래프, 간선, 진입차수, 큐
</span><span class="n">graph</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="nf">tuple</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nf">input</span><span class="p">().</span><span class="nf">split</span><span class="p">()))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">M</span><span class="p">)]</span>
<span class="n">degree</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">que</span> <span class="o">=</span> <span class="nf">deque</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
    <span class="n">graph</span><span class="p">[</span><span class="n">A</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="n">degree</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># 진입차수 0
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">degree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">que</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="k">while</span> <span class="n">que</span><span class="p">:</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="nf">popleft</span><span class="p">()</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>

    <span class="c1"># 연결된 노드 진입차수 감소
</span>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">now</span><span class="p">]:</span>
        <span class="n">degree</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">degree</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">que</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">result</span><span class="p">)))</span>
</code></pre></div></div>

<blockquote>
  <h4 id="채점">채점</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-2252/img02.webp" alt="img02" /></p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>뭐지 위상정렬 왜 재밌지?<br />
그래프 그리는 것 부터 짜증나야하는데<br />
파이썬 코드가 예뻐서 그런 것 같다.</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/BOJ/Python/2025-07-03-2252.py">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="BOJ/Python/" /><category term="PYTHON" /><category term="알고리즘" /><category term="백준" /><category term="2252" /><category term="줄 세우기" /><category term="위상정렬" /><summary type="html"><![CDATA[백준 2252번 줄 세우기 PYTHON 문제풀이]]></summary></entry><entry><title type="html">1669번 멍멍이 쓰다듬기</title><link href="https://movingwoo.com/boj/python/2025/07/03/1669.html" rel="alternate" type="text/html" title="1669번 멍멍이 쓰다듬기" /><published>2025-07-03T00:00:00+00:00</published><updated>2025-07-03T00:00:00+00:00</updated><id>https://movingwoo.com/boj/python/2025/07/03/1669</id><content type="html" xml:base="https://movingwoo.com/boj/python/2025/07/03/1669.html"><![CDATA[<blockquote>
  <h4 id="이왜틀">이왜틀?</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-1669/img01.webp" alt="img01" /></p>

<p><a href="https://www.acmicpc.net/problem/1669">1669번 멍멍이 쓰다듬기 - 백준</a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Scanner</span> <span class="n">sc</span><span class="o">=</span><span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">num</span><span class="o">=(</span><span class="n">sc</span><span class="o">.</span><span class="na">nextLong</span><span class="o">()-</span><span class="n">sc</span><span class="o">.</span><span class="na">nextLong</span><span class="o">())*-</span><span class="mi">1</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">answer</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="o">;;)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">num</span><span class="o">&lt;</span><span class="n">distance</span><span class="o">+</span><span class="n">j</span><span class="o">)</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">else</span> <span class="o">{</span>					
            <span class="n">distance</span><span class="o">+=</span><span class="n">j</span><span class="o">;</span>
            <span class="n">answer</span><span class="o">++;</span>
            <span class="k">if</span><span class="o">(</span><span class="n">answer</span><span class="o">%</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span><span class="o">)</span> <span class="n">j</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">answer</span><span class="o">);</span>
</code></pre></div></div>

<p>얼추 맞는데 한가지 조건을 더 고려해야한다.<br />
키를 0cm 조절할 수도 있다.</p>

<blockquote>
  <h4 id="설계">설계</h4>
  <hr />
</blockquote>

<p>키를 1cm 단위로 조절할 수 있는데, 첫 날과 마지막 날은 반드시 1cm다.<br />
전체 수열은 <span style="color: orange;"><strong>1, 2, 3, 2, 1</strong></span> 형태가 될거다.<br />
수열의 가장 높은 값을 k로 두면 <span style="color: orange;"><strong>수열의 합은 k^2, 길이는 2 * k - 1</strong></span>이다.</p>

<p>0cm 조절도 가능하니 <span style="color: orange;"><strong>1, 2, 3, 3, 2, 1</strong></span> 형태의 수열도 가능하다.<br />
이런 경우 <span style="color: orange;"><strong>합은 k * (k + 1) 이며 길이는 2 * k</strong></span></p>

<blockquote>
  <h4 id="구현">구현</h4>
  <hr />
</blockquote>

<p>위 공식을 적용한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nf">input</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">X</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="n">sub</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">*</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">sub</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">break</span>

    <span class="k">elif</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">sub</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span>
        <span class="k">break</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <h4 id="채점">채점</h4>
  <hr />
</blockquote>

<p><img src="/assets/images/posts/BOJ/Python/2025-07-03-1669/img02.webp" alt="img02" /></p>

<blockquote>
  <h4 id="반성">반성</h4>
  <hr />
</blockquote>

<p>과거 자바코드 변수명이 의아해서 찾아보니 1011번 문제가 이 문제와 흡사하다.</p>

<p><a href="https://www.acmicpc.net/problem/1011">1011번 Fly me to the Alpha Centauri - 백준</a></p>

<p>이 문제는 6년 전에 유사 코드로 통과한 기록이 있다.<br />
아마 비슷한 문제라서 코드를 살짝 고쳐서 집어넣었다가 틀리고 그대로 도망간 것으로 추측된다.</p>

<blockquote>
  <h4 id="코드-확인">코드 확인</h4>
  <hr />
</blockquote>

<p><a href="https://raw.githubusercontent.com/movingwoo/movingwoo-snippets/refs/heads/main/BOJ/Python/2025-07-03-1669.py">Link to GitHub</a></p>]]></content><author><name>movingwoo</name></author><category term="BOJ/Python/" /><category term="PYTHON" /><category term="알고리즘" /><category term="백준" /><category term="1669" /><category term="멍멍이 쓰다듬기" /><category term="수학" /><summary type="html"><![CDATA[백준 1669번 멍멍이 쓰다듬기 PYTHON 문제풀이]]></summary></entry></feed>